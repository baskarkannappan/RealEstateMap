@using RealEstateMap.Models

<div class="house-list-grid" role="list">
    @if (Houses.Count == 0)
    {
        <div class="empty-list">No properties available.</div>
    }
    else
    {
        @foreach (var house in Houses)
        {
            <button type="button" class="house-card" role="listitem" @onclick="() => OnSelect.InvokeAsync(house)">
                <div class="house-card-top">
                    <div class="house-address">@house.Address</div>
                    <span class="house-pill">@house.City</span>
                </div>
                <div class="house-location">@house.City, @house.State Â· PIN @house.PostalCode</div>
                @if (CenterLat.HasValue && CenterLng.HasValue)
                {
                    <div class="house-distance">~@DistanceKm(CenterLat.Value, CenterLng.Value, house.Lat, house.Lng).ToString("0.0") km away</div>
                }
            </button>
        }
    }
</div>

@code {
    [Parameter]
    public IReadOnlyList<HouseLocation> Houses { get; set; } = [];

    [Parameter]
    public double? CenterLat { get; set; }

    [Parameter]
    public double? CenterLng { get; set; }

    [Parameter]
    public EventCallback<HouseLocation> OnSelect { get; set; }

    private static double DistanceKm(double lat1, double lng1, double lat2, double lng2)
    {
        const double radius = 6371;
        var dLat = ToRadians(lat2 - lat1);
        var dLng = ToRadians(lng2 - lng1);
        var a = Math.Sin(dLat / 2) * Math.Sin(dLat / 2) +
                Math.Cos(ToRadians(lat1)) * Math.Cos(ToRadians(lat2)) *
                Math.Sin(dLng / 2) * Math.Sin(dLng / 2);
        var c = 2 * Math.Atan2(Math.Sqrt(a), Math.Sqrt(1 - a));
        return radius * c;
    }

    private static double ToRadians(double degrees) => degrees * Math.PI / 180;
}
